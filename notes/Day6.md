___
# Chapter 4 R 행렬 Matrix
벡터보다 조금 더 복잡한 데이터 구조가 행렬과 배열이다. 행렬과 배열은 벡터처럼 모든 요소가 동일한 데이터의 타입을 가져야 한다.

##### **행렬과 배열은 다차원적 데이터 구조**
벡터 = 일차원적 데이터 구조
행렬과 배열 = 다차원적인 데이터 구조


### 1. 행렬 만들기
행렬은 수학과 과학, 공학 등 다양한 분야에서 매우 중요한 도구이다. 행렬은 데이터를 체계적으로 표현하고 선형 변환, 시스템 해석, 데이터 분석 등의 문제를 수학적으로 해결하기 위한 강력한 도구이다.

##### matrix()
matrix 함수를 이용하면 데이터 벡터를 데이터 행렬로 변환시킬 수 있는 함수이다.
`matrix(n, nrow = , ncol =, byrow = )`
- n : 행렬에 들어갈 값
- nrow : 열, 세로 
- ncol : 행, 가로
- byrow :  열이 아닌 행을 차례대로 채워기
``` r
> n <- 1:10; n
 [1]  1  2  3  4  5  6  7  8  9 10
 
> m <- matrix(n, nrow = 2, ncol = 5); m
     [,1] [,2] [,3] [,4] [,5]
[1,]    1    3    5    7    9
[2,]    2    4    6    8   10

> m <- matrix(n, nrow = 2); m
     [,1] [,2] [,3] [,4] [,5]
[1,]    1    3    5    7    9
[2,]    2    4    6    8   10

> matrix(n, nrow = 2, ncol = 5, byrow = T)
     [,1] [,2] [,3] [,4] [,5]
[1,]    1    2    3    4    5
[2,]    6    7    8    9   10
```


##### dim 속성
원래의 벡터 n과 벡터로 만들어진 행렬 m의 속성을 보기 위해 attributes() 함수를 이용한다. 벡터 n에는 아무 속성도 부여 되지 않았지만 행렬 m은 차원을 의미하는 dim 속성이 부여 되었음을 볼 수 있다.
```r
> attributes(n)
NULL
> attributes(m)
$dim
[1] 2 5

> m <- matrix(n, nrow = 5, ncol = 2); m
     [,1] [,2]
[1,]    1    6
[2,]    2    7
[3,]    3    8
[4,]    4    9
[5,]    5   10
> attributes(m)
$dim
[1] 5 2
```


##### 벡터 출력 vs. 행렬 출력
 행렬 m을 출력한 내용을 보면 벡터와는 다름을 볼 수 있다. 먼저 벡터는 데이터를 R 콘솔의 모든 줄을 차례대로 채우면서 출력하고, 줄이 바뀔 때마다 각 줄의 첫 요소가 벡터의 몇 번째 데이터를 [i] 형태로 보여준다. 반면 행렬은 행과 열의 개수에 맞추어 출력시킬 뿐 아니라 [i,j]형태로 데이터의 위치를 보여준다.

##### matrix 벡터 재사용
행렬을 만들 때 행과 열의 크기를 모두 지정할 수 있다. 만약 벡터의 크기가 행렬의 요소 개수보다 적으면 벡터가 재사용된다. 반대로 벡터의 크기가 행렬의 요소 개수보다 크거나 배수가 되지 않으면 경고 메시지가 출력되고 행렬을 만드는 데는 앞에 있는 벡터 요소들만 사용된다.
```r
> m <- matrix(1:9, nrow = 3, ncol = 3); m
     [,1] [,2] [,3]
[1,]    1    4    7
[2,]    2    5    8
[3,]    3    6    9
> m <- matrix(1, nrow = 3, ncol = 3); m
     [,1] [,2] [,3]
[1,]    1    1    1
[2,]    1    1    1
[3,]    1    1    1
> m <- matrix(1:3, nrow = 3, ncol = 3); m
     [,1] [,2] [,3]
[1,]    1    1    1
[2,]    2    2    2
[3,]    3    3    3
> m <- matrix(11:30, nrow = 3, ncol = 3); m
Warning message:
In matrix(11:30, nrow = 3, ncol = 3) :
  data length [20] is not a sub-multiple or multiple of the number of rows [3]
     [,1] [,2] [,3]
[1,]   11   14   17
[2,]   12   15   18
[3,]   13   16   19
```


### 2. 벡터를 결합하여 행렬 만들기
##### cbind()와 rbind()
- cbind() : col으로 결합
- rbind() : row으로 결합
```r
> cbind(1:5, 10:6)
     [,1] [,2]
[1,]    1   10
[2,]    2    9
[3,]    3    8
[4,]    4    7
[5,]    5    6

> rbind(1:5, 10:6, 11:15)
     [,1] [,2] [,3] [,4] [,5]
[1,]    1    2    3    4    5
[2,]   10    9    8    7    6
[3,]   11   12   13   14   15


> A <- matrix(1:9, nrow = 3, ncol = 3); A
     [,1] [,2] [,3]
[1,]    1    4    7
[2,]    2    5    8
[3,]    3    6    9

# 행렬 + 벡터
> cbind(A, 10:12)
     [,1] [,2] [,3] [,4]
[1,]    1    4    7   10
[2,]    2    5    8   11
[3,]    3    6    9   12
> rbind(10:12, A)
     [,1] [,2] [,3]
[1,]   10   11   12
[2,]    1    4    7
[3,]    2    5    8
[4,]    3    6    9

# 행렬 + 행렬
> cbind(A, A)
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    1    4    7    1    4    7
[2,]    2    5    8    2    5    8
[3,]    3    6    9    3    6    9

# 행렬 + 벡터
> t <- rbind(A, 10:12); t
     [,1] [,2] [,3]
[1,]    1    4    7
[2,]    2    5    8
[3,]    3    6    9
[4,]   10   11   12


> rbind(A, t)
     [,1] [,2] [,3]
[1,]    1    4    7
[2,]    2    5    8
[3,]    3    6    9
[4,]    1    4    7
[5,]    2    5    8
[6,]    3    6    9
[7,]   10   11   12
> cbind(A, t)
Error in cbind(A, t) : number of rows of matrices must match (see arg 2)
-> 각각의 행렬이 가진 행의 개수는 반드시 서로 일치해야한다.
> attributes(A)
$dim
[1] 3 3
> attributes(t)
$dim
[1] 4 3


# 행렬 + 행렬 연결은 행 또는 열의 수가 같아야한다.
> A <- cbind(1:6, 7:9); A
     [,1] [,2]
[1,]    1    7
[2,]    2    8
[3,]    3    9
[4,]    4    7
[5,]    5    8
[6,]    6    9
> cbind(A, 10:11)
     [,1] [,2] [,3]
[1,]    1    7   10
[2,]    2    8   11
[3,]    3    9   10
[4,]    4    7   11
[5,]    5    8   10
[6,]    6    9   11
> rbind(1, 1:5)
     [,1] [,2] [,3] [,4] [,5]
[1,]    1    1    1    1    1
[2,]    1    2    3    4    5
```


### 3. 행렬의 필터링
행과 열 인덱스 벡터
- 벡터와 마찬가지로 행렬도 인덱스 벡터에 의해 필터링을 할 수 있다. 벡터는 오직 한 개의 인덱스 벡터를 가지는데, 행렬은 2차원 만큼 각 차원을 지정할 수 있도록 2개의 인덱스 벡터를 가진다. 첫번째 인덱스 벡터는 추출할 행의 위치를, 두번째 인덱스 벡터는 추출할 열의 위치를 지정하게 된다. 벡터와 마찬가지로 행렬도 자연수, 음의 정수, 논리, 이름 인덱스 벡터를 가질 수 있다.

##### 자연수 인덱스 벡터
```r
> z <- matrix(1:25, nrow = 5, ncol = 5); z
     [,1] [,2] [,3] [,4] [,5]
[1,]    1    6   11   16   21
[2,]    2    7   12   17   22
[3,]    3    8   13   18   23
[4,]    4    9   14   19   24
[5,]    5   10   15   20   25

> z[1,1]
[1] 1
> z[5,5]
[1] 25
> z[1:3, 1]
[1] 1 2 3
> z[2, 1:3]
[1]  2  7 12
> z[c(3,5) ,c(2,4)]
     [,1] [,2]
[1,]    8   18
[2,]   10   20

> z[,2]
[1]  6  7  8  9 10
> z[3,]
[1]  3  8 13 18 23
> z[,c(3,5)]
     [,1] [,2]
[1,]   11   21
[2,]   12   22
[3,]   13   23
[4,]   14   24
[5,]   15   25
> z[,]
     [,1] [,2] [,3] [,4] [,5]
[1,]    1    6   11   16   21
[2,]    2    7   12   17   22
[3,]    3    8   13   18   23
[4,]    4    9   14   19   24
[5,]    5   10   15   20   25
```

##### 음의 정수 인덱스
```r
> z[,-2]
     [,1] [,2] [,3] [,4]
[1,]    1   11   16   21
[2,]    2   12   17   22
[3,]    3   13   18   23
[4,]    4   14   19   24
[5,]    5   15   20   25
> z[-3,]
     [,1] [,2] [,3] [,4] [,5]
[1,]    1    6   11   16   21
[2,]    2    7   12   17   22
[3,]    4    9   14   19   24
[4,]    5   10   15   20   25
> z[,-c(2,4)]
     [,1] [,2] [,3]
[1,]    1   11   21
[2,]    2   12   22
[3,]    3   13   23
[4,]    4   14   24
[5,]    5   15   25
> z[-3,-2]
     [,1] [,2] [,3] [,4]
[1,]    1   11   16   21
[2,]    2   12   17   22
[3,]    4   14   19   24
[4,]    5   15   20   25
```

##### 인덱스 벡터로 행과 열 재배치
```r
> z[5:1,]
     [,1] [,2] [,3] [,4] [,5]
[1,]    5   10   15   20   25
[2,]    4    9   14   19   24
[3,]    3    8   13   18   23
[4,]    2    7   12   17   22
[5,]    1    6   11   16   21
> z[,c(3:5, 1:2)]
     [,1] [,2] [,3] [,4] [,5]
[1,]   11   16   21    1    6
[2,]   12   17   22    2    7
[3,]   13   18   23    3    8
[4,]   14   19   24    4    9
[5,]   15   20   25    5   10

> a <- matrix(sample(1:16), nrow = 4, ncol = 4); a
     [,1] [,2] [,3] [,4]
[1,]    9    4    5    7
[2,]    3    6   11   13
[3,]   10    2   16    1
[4,]   15   14   12    8
> a[,1]
[1]  9  3 10 15
> order(a[,1])
[1] 2 1 3 4
> a[order(a[,1]), ]
     [,1] [,2] [,3] [,4]
[1,]    3    6   11   13
[2,]    9    4    5    7
[3,]   10    2   16    1
[4,]   15   14   12    8
```

##### 논리 인덱스 벡터
``` r
> height <- c(180, 172, 167, 175, 182)
> weight <- c(72, 78, 58, 64, 68)
> year <- c(1, 3, 2, 4, 2)
> A <- cbind(height, weight, year)
> A[ , c(F, T, T)]
     weight year
[1,]     72    1
[2,]     78    3
[3,]     58    2
[4,]     64    4
[5,]     68    2
> A[ A[,1] > 180, ]
height weight   year 
   182     68      2 
> A[ A[,2] < 70, ]
     height weight year
[1,]    167     58    2
[2,]    175     64    4
[3,]    182     68    2
```


##### 행과 열 이름 부여하기: rownames()와 colnames()
벡터와 마찬가지로 행과 열의 이름을 인덱스로 하여 행렬의 부분을 참조할 수 있다. 행렬의 행과 열 이름의 확인과 할당은 rownames()와 colnames() 함수를 이용하여 이루어진다. rbind()나 cbind()에 의해 벡터 변수가 결합되면 변수의 이름이 자동적으로 행이나 열의 이름으로 부여된다.
```r
> colnames(A)
[1] "height" "weight" "year"  
> rownames(A)
NULL
> rownames(A) <- paste("student", 1:5, sep=""); A
         height weight year
student1    180     72    1
student2    172     78    3
student3    167     58    2
student4    175     64    4
student5    182     68    2
> A[,"year"]
student1 student2 student3 student4 student5 
       1        3        2        4        2 
> A["student1",]
height weight   year 
   180     72      1 
> A["student2", "weight"]
[1] 78
> A["student2", 2] # 행과 열의 인덱스 벡터의 종류가 달라도 된다.
[1] 78
```

##### 벡터로서 필터링 하기
만약 행렬 이름 뒤에 인덱스 벡터가 하나밖에 주어지지 않으면, 행렬은 벡터로서 처리되어 필터링되고 행렬의 차원 정보는 무시된다.
``` r
> z
     [,1] [,2] [,3] [,4] [,5]
[1,]    1    6   11   16   21
[2,]    2    7   12   17   22
[3,]    3    8   13   18   23
[4,]    4    9   14   19   24
[5,]    5   10   15   20   25

> z[10]
[1] 10

> z[z>15]
 [1] 16 17 18 19 20 21 22 23 24 25
```